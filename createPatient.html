<!DOCTYPE html>
<html>
<head>
    <title>SHS SMART ON FHIR</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <style>
        table {
            font-family: arial, sans-serif;
            border-collapse: collapse;
            width: 10%;
            font-size: 8px;
        }

        td, th {
            border: 1px solid #dddddd;
            text-align: left;
            padding: 3px;
        }

        tr:nth-child(even) {
            background-color: #dddddd;
        }
    </style>
</head>
<body>
<div class="jumbotron text-center" style="margin-bottom:0">
    <img src="images/shs_logo2.png" height="128" width="170"/>
    <h2>SHS PathWays</h2>
    <br/>
    <br/>
    <br/>
    <h3 id="title"></h3>
    <br/>
    <br/>
    <br/>
    <h4 id="showPatientDoesNotExist"></h4>
    <br/>
    <br/>
    <br/>
    <br/>
</div>
<h4 id="showSOFEncounters"></h4>
</body>

<script>
    function showPatientDoesNotExist() {
        var text = 'No record found for Patient ' + '<p style="color:blue"><b>' + sessionStorage.getItem('firstName') + ' '
            + sessionStorage.getItem('lastName') + '</b></p>' + '<br/>' + 'Configured Instance: ' + '<p style="color:blue"><b>' + sessionStorage.getItem('Hospital') + '</b></p>' + '<br/>'
            + 'Configured Endpoint: ' + '<p style="color:blue"><b>' + sessionStorage.getItem('instanceEnvironment') + '</b></p>' + '<br/>' + 'EHR Organization name: '
            + '<p style="color:blue"><b>' + sessionStorage.getItem('organization') + '</b></p>' + '<br/>' + ' <button type="button" class="btn btn-primary"">CREATE PATIENT </button>' + '<p style="color:blue"><b> in instance ' + sessionStorage.getItem('Hospital') + '</b></p>';
        document.getElementById('showPatientDoesNotExist').innerHTML = text;
    }

    // Check browser support
    if (typeof (Storage) !== 'undefined') {

        var encounterResource = JSON.parse(sessionStorage.getItem('_encounterByPatientIdResource'));

        createEHREncounterTable(encounterResource);

        var patientExists = sessionStorage.getItem('patientExists');

        if (patientExists == 'false') {
            showPatientDoesNotExist();
        }

        function createEHREncounterTable(encounterResource) {
            var obj, txt = '';

            obj = {table: 'customers', limit: 20};
            dbParam = JSON.stringify(obj);
            xmlhttp = new XMLHttpRequest();
            txt += '<table border=\'1\'>';
            txt += '<tr><th>Status</th><th>CareType</th><th>Clinical Profile</th><th>Create Encounter In PathWays</th></tr>';

            function sanitizeEncounterTextDiv(encounter) {
                if (encounter && encounter.text && encounter.text.div)
                    return encounter.text.div;
                else return '';
            }

            function sanitize(input) {
                if (input == undefined)
                    return '';
                else return input;
            }

            encounterResource.forEach(function (FHIRresource) {
                var encounter = FHIRresource.resource;
                txt += '<tr><td>' + sanitize(encounter.status) + '</td><td>' + sanitize(encounter.type[0].text) + '</td><td>' + sanitizeEncounterTextDiv(encounter) + '</td><td><button class="editbtn">Create Encounter In PathWays</button></td></tr>';
            });
            txt += '</table>';
            document.getElementById('showSOFEncounters').innerHTML = txt;
            document.getElementById('title').innerHTML = 'Patient ' + sessionStorage.getItem('firstName') + ' '
                + sessionStorage.getItem('lastName') + ' EHR CareTypes';
        }
    } else {
        // Retrieve
        document.getElementById('title').innerHTML = 'Oups, session Storage is not supported by your browser';
    }
</script>
</html>